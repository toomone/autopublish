# This is a basic workflow that is manually triggered

name: Create Branch 2

# Controls when the action will run. Workflow runs when manually triggered using the UI
# or API.
on:
  workflow_dispatch:
    # Inputs the workflow accepts.
    inputs:
      name:
        # Friendly description to be shown in the UI instead of 'name'
        description: 'Person to greet'
        # Default value if no value is explicitly provided
        default: 'World'
        # Input has to be provided for the workflow to run
        required: true

# A workflow run is made up of one or more jobs that can run sequentially or in parallel
jobs:
  # This workflow contains a single job called "greet"
  create_branch:
    # The type of runner that the job will run on
    runs-on: ubuntu-latest

    # Steps represent a sequence of tasks that will be executed as part of the job
    steps:

      - uses: actions/checkout@v2
      
      - name: Get current date
        id: date
        run: echo "::set-output name=date::$(date +'%Y-%m-%d')"

      # Create a branch for monthly publication
      - name: Create branch for publication
        run: git checkout -b autopublish-${{ steps.date.outputs.date }}

      # Create a branch for monthly publication
      - name: Display current directory
        run: pwd

      - name: Display debug message
        run: echo "::debug::'ok it works'"        


      - name: Display current directory
        run: echo "::command-name"        

      # Create a branch for monthly publication
      - name: Display home directory
        run: echo ${{env.HOME}}

      # Read content from cartridge for Github pages
      - name: Read cartridge.yml
        id: cartridge
        uses: juliangruber/read-file-action@v1
        with:
          path: cartridge.yml

      - name: Echo cartridge.yml
        run: echo ${{ steps.cartridge.outputs.content }}      

      # Read content from post for Github pages
      - name: Read content.yml
        id: content
        uses: juliangruber/read-file-action@v1
        with:
          path: ./content.yml
      - name: Echo content.yml
        run: echo ${{ steps.content.outputs.content }}              
      
      # Append cartridge to post
      - name: Append cartridge to post file
        uses: DamianReeves/write-file-action@v1.0
        with:
          path: ./post.yml
          contents: |
            echo "${{ steps.cartridge.outputs.content }}"

      # Append cartridge to post
      - name: Append content to post file
        uses: DamianReeves/write-file-action@v1.0
        with:
          path: ./post.yml
          contents: |
            echo "${{ steps.content.outputs.content }}"
          write-mode: append                
